<div class="landing-background">
    <div class="checkout-container">
        <div class="checkout-form">
            <h2>Finalizar compra</h2>
            <form [formGroup]="checkoutForm" (ngSubmit)="confirmOrder()">
                <div class="form-group">
                    <label>Nombre completo</label>
                    <input type="text" formControlName="fullName" placeholder="Ingresa tu nombre" />
                </div>

                <div class="form-group">
                    <label>Dirección</label>
                    <input type="text" formControlName="address" placeholder="Ingresa tu dirección" />
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" formControlName="email" placeholder="correo@ejemplo.com" />
                </div>

                <div class="form-group">
                    <label for="paymentMethod">Método de pago</label>
                    <select formControlName="paymentMethod" id="paymentMethod">
                        <option value="">Seleccione</option>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Transferencia">Transferencia</option>
                    </select>
                </div>

                <div *ngIf="checkoutForm.value.paymentMethod === 'Tarjeta'">
                    <div class="form-group card-input">
                        <label for="cardNumber">Número de tarjeta</label>
                        <input type="text" id="cardNumber" formControlName="cardNumber" inputmode="numeric"
                            placeholder="XXXX-XXXX-XXXX-XXXX" autocomplete="cc-number" maxlength="19"
                            (input)="formatCardNumber($event)" />
                    </div>

                    <div class="form-group">
                        <label>Fecha de expiración</label>
                        <div class="expiry-selects">
                            <select formControlName="cardExpiryMonth">
                                <option value="">Mes</option>
                                <option *ngFor="let m of months" [value]="m.value">{{ m.label }}</option>
                            </select>

                            <select formControlName="cardExpiryYear">
                                <option value="">Año</option>
                                <option *ngFor="let y of years" [value]="y">{{ y }}</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cardCvv">CVV</label>
                        <input type="text" id="cardCvv" formControlName="cardCvv" inputmode="numeric" placeholder="123"
                            autocomplete="cc-csc" maxlength="4" />
                    </div>

                </div>

                <div *ngIf="checkoutForm.value.paymentMethod === 'Transferencia'">
                    <div class="transfer-info">
                        <h4>Datos del comercio</h4>
                        <p><strong>Banco:</strong> Banco XXX</p>
                        <p><strong>Número de cuenta:</strong> 000-000-000</p>
                        <p><strong>Titular:</strong> Comercio XXX</p>
                    </div>
                    <div class="form-group">
                        <label>número de confirmación/comprobante</label>
                        <input type="text" formControlName="transactionId" placeholder="Código de la transacción">
                    </div>
                </div>

                <div class="actionOrder">
                    <button class="btn-confirm" type="submit">
                        Confirmar orden
                    </button>
                    <button class="btn-confirm" (click)="cancelarOrden()">
                        Cancelar orden
                    </button>
                </div>
            </form>
        </div>

        <div class="checkout-summary">
            <h2>Tu carrito</h2>
            <div *ngIf="cart.length > 0; else emptyCart">
                <ul class="cart-list">
                    <li *ngFor="let item of cart" class="cart-item">
                        <div class="item-left">
                            <img *ngIf="item.productImageUrl" [src]="item.productImageUrl" alt="{{item.productName}}"
                                class="thumb" />
                            <div class="item-info">
                                <div class="item-name">{{ item.productName }}</div>
                                <div class="item-qty">x{{ item.quantity }}</div>
                            </div>
                        </div>
                        <div class="item-right">
                            <div class="item-price">
                                ${{ (item.productPrice * item.quantity) | number:'1.0-0' }}
                            </div>
                            <button class="remove-btn" (click)="removeFromCart(item.productId)">
                                <fa-icon [icon]="faTrash"></fa-icon>
                            </button>
                        </div>
                    </li>
                </ul>

                <div class="summary-footer">
                    <div class="total">
                        <span>Total:</span>
                        <strong>${{ total | number:'1.0-0' }}</strong>
                    </div>
                </div>
            </div>

            <ng-template #emptyCart>
                <p class="empty">Tu carrito está vacío.</p>
            </ng-template>
        </div>
    </div>
</div>

<div class="modal-overlay" *ngIf="showConfirmationModal">
    <div class="modal-content">
        <button class="close-btn" (click)="closeModal()">✕</button>

        <div class="modal-two-columns">
            <div class="modal-left">
                <h2>Datos del cliente</h2>
                <p><strong>Nombre:</strong> {{ orderSummary?.customer?.fullName }}</p>
                <p><strong>Email:</strong> {{ orderSummary?.customer?.email }}</p>
                <p><strong>Dirección:</strong> {{ orderSummary?.customer?.address }}</p>
                <p><strong>ID Orden:</strong> {{ orderSummary?.id }}</p>
                <p class="muted">{{ orderSummary?.date }}</p>
                <p><strong>Método de pago</strong></p>
                <ng-container [ngSwitch]="orderSummary?.customer?.paymentMethod">
                    <div *ngSwitchCase="'Tarjeta'">
                        <p><strong>Tipo:</strong> Tarjeta</p>
                        <p><strong>Número:</strong> **** **** **** {{ orderSummary?.customer?.cardNumber?.slice(-4) }}
                        </p>
                        <p><strong>Expiración:</strong> {{ orderSummary?.customer?.cardExpiry }}</p>
                    </div>

                    <div *ngSwitchCase="'Transferencia'">
                        <p><strong>Tipo:</strong> Transferencia</p>
                        <p><strong>Banco:</strong> {{ orderSummary?.customer?.bankName }}</p>
                        <p><strong>ID Transacción:</strong> {{ orderSummary?.customer?.transactionId }}</p>
                    </div>

                    <div *ngSwitchCase="'Efectivo'">
                        <p><strong>Tipo:</strong> Efectivo</p>
                        <p>El pago se realizará al momento de la entrega.</p>
                    </div>
                    <div *ngSwitchDefault>
                        <p><em>No se especificó método de pago.</em></p>
                    </div>
                </ng-container>

            </div>

            <div class="modal-right">
                <h2>Resumen de la orden</h2>
                <div class="order-items">
                    <ul>
                        <li *ngFor="let it of orderSummary?.items">
                            <span>{{ it.productName }} x{{ it.quantity }}</span>
                            <span class="sub">${{ (it.productPrice * it.quantity) | number:'1.0-0' }}</span>
                        </li>
                    </ul>
                </div>

                <div class="order-total">
                    <strong>Total:</strong> ${{ orderSummary?.total | number:'1.0-0' }}
                </div>

                <div class="modal-actions">
                    <button class="btn-confirm" (click)="closeModal()">
                        Cerrar y volver a la tienda
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>